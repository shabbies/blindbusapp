<html>
	<head>		
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
		<script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>

		<style>
			#mainDiv {
    			margin-left: 35px;
    			margin-right: 35px;
    			text-align: center;
			}

			#instructionsID ul {
				display:table; 
				margin:0 auto;
			}

			#audio-player {
				opacity: 0.1; /* This is to make the audio tag transparent/invisible */
			}

			.btn-big {
				height: 1000px;
				width: 800px;
			}
		</style>
	</head>
	<!--<body onclick="trackNumClick()">-->
	<body>

		<title>Bus Selection</title>
		
		<div id="mainDiv">
			<div class="row">
				<div class="page-header col-md-12">

					<!-- <audio controls id="audio-player">
					  	<source id="audio-player-source" src="<%= asset_path('Bus_Number_English.mp3') %>" type="audio/mpeg">
					</audio> --> 

					<h1>Requesting for Bus Number</h1>
				</div>
			</div>

			<div class="row">
				<div class="col-md-12" id="instructionsID" >
					After the phone has vibrated, the user has to verbalize the bus number he/she wants to board.
				</div>
			</div>

			<br/>

			<div class="row">
				<div class="btn-group" role="group">
				  <button type="button" class="btn btn-danger col-md-12 btn-big" id="upload_voice">
				  	<font size="8">TAP HERE TO SPEAK</font></button>
				</div>
			</div>

			<div class="row">
				<div class="col-md-12">
					<%= form_tag(pages_path, :method=>'post', :multipart => true, id: "speech_form", hidden: true) do %>
				   	<%= file_field_tag "attachment", accept: 'audio/*', capture: true, id: "fileupload" %>
				   	<%= submit_tag 'Submit', hidden: true%>
					<% end %>
				</div>
			</div>


			<div class="row">
				<div class="col-md-12">
					<p class="blinking"><font color="red" size="5"><span id="listen_input"> Listening for input ... </span></font></p>
					<b><font size="6">Bus Number <br/><u><span class="tapValue"><font color="red">-</font></span></u></font></b>
				</div>
			</div>

		</div>
	</body>
</html>

<script src="https://code.responsivevoice.org/responsivevoice.js"></script>
<script>
	// enable vibration support
	navigator.vibrate = navigator.vibrate || navigator.webkitVibrate || navigator.mozVibrate || navigator.msVibrate;

	$(document).ready(function () {


		setTimeout(function(){
			responsiveVoice.speak("Please say the bus number you wish to board, after the phone has vibrated.");
		}, 2000); 

		//after responsive voice, then vibrate
		if (navigator.vibrate) {
		    navigator.vibrate(1000);
		} //end navigator vibrate
		

		$('#listen_input').hide(); //this will only show when system is ready to listen for input

		/*
		//this will return selected_language=English/Mandarin 
		url_params = window.location.search.substr(1).split('=');
		selected_language = url_params[2];

		if (selected_language == "Mandarin"){
			$("#audio-player-source").attr("src", "<%= asset_path('Bus_Number_Mandarin.mp3') %>");
		} */


    

		function blinker() {
			$('.blinking').fadeOut(300);
			$('.blinking').fadeIn(300);
		}
		setInterval(blinker, 1000);

		/*
		$('#start_btn').click(function() {
			var audioPlayer = document.getElementById('audio-player');
	    	audioPlayer.play();
	    	$('#start_btn').hide();
	    	//$('#listen_input').show();
		}); */

		$("#upload_voice").click(function() {
			$("#fileupload").click();
		});

		$("#fileupload").change(function(){
			$("#speech_form").submit();
		});	




	});



</script>